tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.3/types.yaml
  - plugin.yaml

inputs:

  terraform_path:
    type: string

  AWS_ACCESS_KEY_ID:
    type: string

  AWS_SECRET_ACCESS_KEY:
    type: string

  AWS_DEFAULT_REGION:
    type: string
    default: 'us-east-1'

node_templates:

  eip_example:
    type: cloudify.nodes.terraform.Module
    properties:
      resource_config:
        source: blueprints/resources/eip.zip
        variables:
          key_name: my_key
        environment_variables:
          AWS_ACCESS_KEY_ID: { get_input: AWS_ACCESS_KEY_ID }
          AWS_SECRET_ACCESS_KEY: { get_input: AWS_SECRET_ACCESS_KEY }
          AWS_DEFAULT_REGION: { get_input: AWS_DEFAULT_REGION }
    interfaces:
      cloudify.interfaces.lifecycle:
        configure:
          inputs:
            resource_config: { get_property: [ SELF, resource_config ] }
            terraform_path: { get_input: terraform_path }
